(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function k(t){if(!t||!Array.isArray(t.milestones)||!Array.isArray(t.costData)||!Array.isArray(t.pointsData))throw new Error("Invalid data structure received from server.");return t}async function O(t){const n=`journeyData_v${t&&t.dataVersion?String(t.dataVersion):"1"}`;try{const o=localStorage.getItem(n);if(o){const i=JSON.parse(o);return k(i)}}catch(o){console.warn(`Ignoring corrupt cache for key: ${n}`,o),localStorage.removeItem(n)}try{const[o,i,a]=await Promise.all([fetch("data/milestones.json",{credentials:"same-origin"}),fetch("data/costData.json",{credentials:"same-origin"}),fetch("data/pointsData.json",{credentials:"same-origin"})]);if(!o.ok||!i.ok||!a.ok)throw new Error("Network response was not ok while fetching journey data.");const s=await o.json(),r=await i.json(),l=await a.json(),d={milestones:s.sort((p,D)=>new Date(p.date)-new Date(D.date)),costData:r,pointsData:l};k(d);try{localStorage.setItem(n,JSON.stringify(d))}catch{}return d}catch(o){throw console.error("Failed to load journey data:",o),o}}const q="prDashboardState";function z(){try{const t=localStorage.getItem(q);if(t)return JSON.parse(t)}catch(t){console.error("Could not load state from localStorage",t)}return{points:{},costs:{}}}const g=z();let w=[];function x(t){Object.assign(g,t);try{localStorage.setItem(q,JSON.stringify(g))}catch(e){console.error("Could not save state to localStorage",e)}w.forEach(e=>e())}function H(t){return w.push(t),()=>{w=w.filter(e=>e!==t)}}const U=new Date().toLocaleDateString("sv-SE",{timeZone:"Australia/Perth"}),u=new Date(U),f=(t,e)=>Math.round((new Date(e)-new Date(t))/(1e3*60*60*24));function m(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function S(t,e,n=800){let o=null;const i=a=>{o||(o=a);const s=Math.min((a-o)/n,1);t.textContent=Math.floor(s*e).toLocaleString(),s<1&&window.requestAnimationFrame(i)};window.requestAnimationFrame(i)}function V(t,e,n,o=800){let i=null;const a=s=>{i||(i=s);const r=Math.min((s-i)/o,1),l=Math.floor(r*e);t.textContent=n(l),r<1&&window.requestAnimationFrame(a)};window.requestAnimationFrame(a)}function h(t,e){setTimeout(()=>{t&&(t.style.width=e,t.style.transform="scaleX(1)")},100)}function W(t,e){t.querySelectorAll(".interactive-checkbox:not(:disabled)").forEach(n=>{n.addEventListener("change",o=>{const i=o.target.dataset.id,a={...g[e],[i]:!!o.target.checked};x({[e]:a})})})}const Y=t=>{const e=new Date(t);let n=u.getFullYear()-e.getFullYear();const o=u.getMonth()-e.getMonth();return(o<0||o===0&&u.getDate()<e.getDate())&&n--,n};function J(t,e,n){const o=Y(n.userDOB),i=new Date(n.userDOB),a=e.find(s=>s.id==="jrp_complete");return t.map(s=>{const r={...s};if(s.achievedDate==="BIRTHDAY_25"){const l=i.getFullYear()+25,c=i.getMonth(),d=i.getDate();r.achievedDate=new Date(l,c,d).toISOString().slice(0,10),r.currentPoints=o<25?25:30}return s.achievedDate==="JRP_COMPLETE"&&(r.achievedDate=a?a.date:null),r})}function _(t,e,n,o){const i=J(t,e,n);let a=0;o.pointsBreakdown.innerHTML=i.map(r=>{const l=r.achievedDate&&new Date(r.achievedDate)<=u,c=!!g.points[r.id]||l||!!r.initial,d=c?r.points:r.currentPoints||0;a+=d;const p=c?"points-calculator__value--achieved":"points-calculator__value--pending";return`<div class="points-calculator__item">
      <input type="checkbox" class="interactive-checkbox" id="check_${m(r.id)}" data-id="${m(r.id)}" ${c?"checked":""} ${l?"disabled":""}>
      <label for="check_${m(r.id)}" class="points-calculator__label">${m(r.label)}</label>
      <div class="tooltip-wrapper">
        <span class="tooltip" aria-label="More info">(i)</span>
        <div class="tooltip-text">${m(r.tooltip)}</div>
      </div>
      <span class="points-calculator__value ${p}">${d}</span>
    </div>`}).join(""),o.currentTotalPoints.textContent=a,S(o.currentPoints,a);const s=`${Math.min(100,a/n.pointsTarget*100)}%`;h(o.pointsProgress,s),o.pointsBreakdown&&(W(o.pointsBreakdown,"points"),o.pointsBreakdown.querySelectorAll(".tooltip-wrapper").forEach(r=>{r.addEventListener("click",l=>{document.querySelectorAll(".tooltip-wrapper.is-active").forEach(c=>{c!==r&&c.classList.remove("is-active")}),r.classList.toggle("is-active")})}))}function G(t,e){t.querySelectorAll(".interactive-checkbox:not(:disabled)").forEach(n=>{n.addEventListener("change",o=>{const i=o.target.dataset.id,a={...g[e],[i]:!!o.target.checked};x({[e]:a})})})}const y=t=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",minimumFractionDigits:0}).format(t);function M(t,e){const n=t.reduce((a,s)=>a+s.amount,0);let o=0;e.costTracker.innerHTML=t.map(a=>{const s=a.paid===!0,r=s||!!g.costs[a.id];return r&&(o+=a.amount),`<div class="cost-tracker__item">
        <input type="checkbox" class="interactive-checkbox" id="cost_${m(a.id)}" data-id="${m(a.id)}" ${r?"checked":""} ${s?"disabled":""}>
        <label for="cost_${m(a.id)}" class="cost-tracker__label">${m(a.label)}</label>
        <span>${y(a.amount)}</span>
      </div>`}).join(""),e.totalCostSpent.textContent=y(o),V(e.totalSpentDisplay,o,y),e.totalBudgetDisplay.textContent=`Budget: ${y(n)}`;const i=n>0?`${Math.min(100,o/n*100)}%`:"0%";h(e.investmentProgress,i),e.costTracker&&G(e.costTracker,"costs")}function Z(t){const e=t.filter(n=>{const o=f(u,new Date(n.date));return o>0&&o<=7});e.length>0&&"Notification"in window&&Notification.permission!=="denied"&&Notification.requestPermission().then(n=>{n==="granted"&&e.forEach(o=>{const i=f(u,new Date(o.date));new Notification("Upcoming PR Milestone",{body:`${o.title} is in ${i} day(s).`,icon:"/assets/android-chrome-192x192.png"})})})}function K(t,e,n){const o=t.find(p=>p.id==="visa_extend"),i=o&&new Date(o.date)<=u,a=i?e.finalVisaExpiryDate:e.initialVisaExpiryDate,s=f(u,a);s>0?S(n.daysRemaining,s):n.daysRemaining.textContent="BVA",n.visaStatus.textContent=i?"Expires Feb 2028 (Ext. Active)":"Expires Feb 2027 (Ext. Pending)";const r=Math.max(1,f(e.journeyStartDate,a)),l=Math.max(0,f(e.journeyStartDate,u)),c=`${Math.min(100,l/r*100)}%`;h(n.visaTimeProgress,c),n.pointsTargetDisplay&&(n.pointsTargetDisplay.textContent=`Target: ${e.pointsTarget}`);const d=t.filter(p=>new Date(p.date)>u);if(d.length>0){const p=d[0],D=f(u,p.date);S(n.nextMilestoneCountdown,D),n.nextMilestoneTitle.textContent=m((p.title||"").trim());const L=Math.max(0,t.findIndex(N=>N.id===p.id)-1),T=L>=0?new Date(t[L].date):new Date(e.journeyStartDate),F=Math.max(1,f(T,p.date)),R=Math.max(0,f(T,u)),j=`${Math.min(100,R/F*100)}%`;h(n.milestoneProgress,j)}else n.nextMilestoneCountdown.textContent="—",n.nextMilestoneTitle.textContent="All milestones completed",h(n.milestoneProgress,"100%");Z(t)}function X(t,e,n){const o=t.find(c=>c.id==="visa_extend"),a=o&&new Date(o.date)<=u?e.finalVisaExpiryDate:e.initialVisaExpiryDate,s=f(u,a);let r=[];const l=t.find(c=>{const d=new Date(c.date);return d>=u&&f(u,d)<=14});l&&r.push({type:"info",msg:`<strong>Upcoming:</strong> ${m(l.title)}. This is happening now or in the next two weeks!`}),s<90&&s>0?r.push({type:"warning",msg:"<strong>Visa alert:</strong> Less than 90 days remaining on your current visa. Ensure next steps are taken!"}):s<365&&s>0&&r.push({type:"info",msg:"<strong>Visa alert:</strong> Less than one year remaining on your current visa."}),r.length===0&&r.push({type:"success",msg:"All systems are green. You are on track!"}),n.alertsContainer.innerHTML=r.map(c=>`<div class="alert ${c.type==="success"?"alert--success":c.type==="warning"?"alert--warning":c.type==="error"?"alert--error":"alert--info"}"><i class="fas fa-info-circle" aria-hidden="true"></i>${c.msg}</div>`).join("")}function Q(t,e,n,o){const i=document.querySelector(".main-content");if(!i)return;const a={currentPoints:i.querySelector("#currentPoints"),pointsProgress:i.querySelector("#pointsProgress"),pointsBreakdown:i.querySelector("#points-breakdown"),currentTotalPoints:i.querySelector("#currentTotalPoints"),costTracker:i.querySelector("#cost-tracker"),totalCostSpent:i.querySelector("#total_cost_spent"),totalSpentDisplay:i.querySelector("#totalSpentDisplay"),totalBudgetDisplay:i.querySelector("#totalBudgetDisplay"),investmentProgress:i.querySelector("#investmentProgress"),daysRemaining:i.querySelector("#daysRemaining"),visaStatus:i.querySelector("#visaStatus"),visaTimeProgress:i.querySelector("#visaTimeProgress"),nextMilestoneCountdown:i.querySelector("#nextMilestoneCountdown"),nextMilestoneTitle:i.querySelector("#nextMilestoneTitle"),milestoneProgress:i.querySelector("#milestoneProgress"),alertsContainer:i.querySelector("#alertsContainer"),pointsTargetDisplay:i.querySelector("#pointsTargetDisplay"),resetDataBtn:i.querySelector("#resetDataBtn"),resetDataBtn2:i.querySelector("#resetDataBtn2")};function s(){const r=l=>{const c=`Are you sure you want to reset the ${l} tracker?`;confirm(c)&&(x({[l]:{}}),window.scrollTo({top:0,behavior:"smooth"}))};a.resetDataBtn&&(a.resetDataBtn.addEventListener("click",()=>r("points")),a.resetDataBtn.title="Reset Points Calculator"),a.resetDataBtn2&&(a.resetDataBtn2.addEventListener("click",()=>r("costs")),a.resetDataBtn2.title="Reset Investment Tracker")}H(()=>{_(n,t,o,a),M(e,a)}),_(n,t,o,a),M(e,a),K(t,o,a),X(t,o,a),s(),i.querySelectorAll(".skeleton-item").forEach(r=>r.remove()),i.querySelectorAll(".key-metrics__item, .points-calculator__item, .cost-tracker__item").forEach(r=>{r.style.display==="none"&&(r.style.display="")})}function A(t,e="all"){const n=document.getElementById("timeline");if(!n)return;const o=t.filter(s=>e==="all"||s.phase===e),i=o.findLastIndex(s=>new Date(s.date+"T00:00:00")<=u),a=i>=0?(i+1)/o.length*100:0;n.innerHTML=`<div id="timeline-progress-fill" class="timeline__progress-fill" style="height: ${a}%"></div>`+o.map(s=>{const r=new Date(s.date+"T00:00:00"),l=r<=u,c=r.toLocaleDateString("en-AU",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"Australia/Perth"}),d=l?"timeline__icon--completed":"timeline__icon--future",p=l?"fa-check":"fa-hourglass-start";return`
            <div class="timeline__milestone" data-phase="${s.phase}">
                <div class="timeline__header" data-id="${s.id}" aria-expanded="false" aria-controls="details_${s.id}">
                    <div class="timeline__icon ${d}">
                        <i class="fas ${p}"></i>
                    </div>
                    <div class="timeline__content">
                        <div class="timeline__title">${s.title}</div>
                        <div class="timeline__date">${c}</div>
                    </div>
                </div>
                <div class="timeline__details" id="details_${s.id}"><p>${s.details}</p></div>
            </div>`}).join(""),document.querySelectorAll(".timeline__header").forEach(s=>{const r=l=>{const d=document.getElementById(`details_${l.currentTarget.dataset.id}`).classList.toggle("timeline__details--visible");l.currentTarget.setAttribute("aria-expanded",d),d&&l.currentTarget.scrollIntoView({behavior:"smooth",block:"nearest"})};s.addEventListener("click",r)})}function tt(t){A(t);const e=document.querySelector(".toggle-buttons");e&&(e.querySelectorAll(".toggle-buttons__button").forEach(n=>{n.setAttribute("aria-pressed",n.classList.contains("active")?"true":"false")}),e.addEventListener("click",n=>{n.target.tagName==="BUTTON"&&(document.querySelectorAll(".toggle-buttons__button").forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-pressed","false")}),n.target.classList.add("active"),n.target.setAttribute("aria-pressed","true"),A(t,n.target.dataset.phase))}))}function et(){const t=document.getElementById("navigation-menu"),e=document.getElementById("hamburger-menu"),n=document.getElementById("close-menu"),o=document.getElementById("overlay"),i=()=>{document.body.classList.add("menu-is-open"),t&&(t.classList.add("is-open"),t.setAttribute("aria-hidden","false"),n&&n.focus()),o&&o.classList.add("is-visible")};e&&e.addEventListener("click",i),n&&n.addEventListener("click",E),o&&o.addEventListener("click",E)}function E(){const t=document.getElementById("navigation-menu"),e=document.getElementById("overlay"),n=document.getElementById("hamburger-menu");n&&n.focus(),document.body.classList.remove("menu-is-open"),t&&(t.classList.remove("is-open"),t.setAttribute("aria-hidden","true")),e&&e.classList.remove("is-visible")}function nt(){const t=document.getElementById("dark-mode-toggle");localStorage.getItem("theme")==="dark"&&(document.body.classList.add("dark-mode"),t&&(t.checked=!0)),t&&t.addEventListener("change",function(){document.body.classList.toggle("dark-mode",this.checked),localStorage.setItem("theme",this.checked?"dark":"light")})}function ot(){if(document.getElementById("scrollToTopBtn"))return;document.body.insertAdjacentHTML("beforeend",'<a href="#" id="scrollToTopBtn" class="scroll-to-top-btn" title="Go to top" aria-label="Scroll to top"><i class="fas fa-chevron-up" aria-hidden="true"></i></a>');const e=document.getElementById("scrollToTopBtn");e&&(window.addEventListener("scroll",()=>{e.classList.toggle("visible",window.scrollY>300)}),e.addEventListener("click",n=>{n.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})}))}function C(){const t=document.getElementById("currentDate"),e=document.getElementById("currentTime");if(t&&e){const n=new Date,o={timeZone:"Australia/Perth"};t.textContent=n.toLocaleDateString("en-AU",{weekday:"long",year:"numeric",month:"long",day:"numeric",...o}),e.textContent=n.toLocaleTimeString("en-AU",{hour12:!0,hour:"numeric",minute:"2-digit",second:"2-digit",...o}).toLowerCase()+" AWST"}}function it(){document.querySelectorAll(".copy-btn").forEach(t=>{if(t.dataset.bound==="1")return;t.dataset.bound="1";const e=t.querySelector(".tooltip-text");t.addEventListener("click",()=>{const n=t.dataset.copy||"";navigator.clipboard.writeText(n).then(()=>{if(e){const o=e.textContent;e.textContent="Copied!",t.classList.add("copied"),setTimeout(()=>{e.textContent=o||"Copy",t.classList.remove("copied")},1200)}}).catch(o=>console.error("Failed to copy text: ",o))})})}function at(){const t=document.querySelector("img.profile-picture");t&&t.addEventListener("error",()=>{t.src="https://placehold.co/180x180/00529B/FFFFFF?text=RG"},{once:!0})}function rt(){document.addEventListener("click",t=>{t.target.closest(".tooltip-wrapper")||document.querySelectorAll(".tooltip-wrapper.is-active").forEach(e=>{e.classList.remove("is-active")})})}function B(t=location.pathname){const e=o=>(o||"").replace(location.origin,"").split(/[?#]/)[0].replace(/\/index\.html$/i,"/")||"/",n=e(t);document.querySelectorAll("nav a, #navigation-menu a, header a[data-nav], .site-nav a").forEach(o=>{const i=o.getAttribute("href");if(!i||i.startsWith("#")||i.startsWith("mailto:")){o.classList.remove("active","is-active"),o.removeAttribute("aria-current");return}let a=i;try{a=new URL(i,location.origin).pathname}catch{}const r=e(a)===n;o.classList.toggle("active",r),o.classList.toggle("is-active",r),r?o.setAttribute("aria-current","page"):o.removeAttribute("aria-current")})}function st(){const t=document.getElementById("copyright-year");t&&(t.textContent=new Date().getFullYear())}function P(){et(),nt(),ot(),rt(),st(),at(),document.getElementById("currentDate")&&(C(),setInterval(C,1e3)),document.querySelector(".copy-btn")&&it()}const I={"/":{file:"index.html",title:"PR Journey Dashboard"},"/about":{file:"about.html",title:"About Me"},"/plan":{file:"plan.html",title:"My PR Plan"},"/visa":{file:"visa.html",title:"Visa Background"},"/documents":{file:"documents.html",title:"Documents Hub"},"/contact":{file:"contact.html",title:"Contact"}},$=".main-content";function v(t){let n=new URL(t,window.location.origin).pathname;return n=n.replace(/\/{2,}/g,"/"),n.length>1&&n.endsWith("/")&&(n=n.slice(0,-1)),n||"/"}function ct(t){const e=new URL(t.href,window.location.origin);return e.origin===window.location.origin&&I.hasOwnProperty(e.pathname.replace(/\/{2,}/g,"/").replace(/\/$/,"")||"/")}async function b(t){const e=I[t],n=document.querySelector($);n&&(n.classList.add("fade-out"),setTimeout(async()=>{if(!e){n.innerHTML=`<div class="card"><div class="card-header"><i class="fas fa-exclamation-triangle"></i> Page not found</div><p>We couldn't find <code>${t}</code>. Try the <a href="/">Dashboard</a>.</p></div>`,B("/"),document.title="Not Found | Australian PR Journey",n.classList.remove("fade-out");return}try{const o=await fetch(e.file,{credentials:"same-origin"});if(!o.ok)throw new Error("Failed to fetch page");const i=await o.text(),a=new DOMParser().parseFromString(i,"text/html"),s=a.querySelector($);if(!s)throw new Error("Malformed page: missing main content");n.innerHTML=s.innerHTML,document.title=a.title||`🇦🇺 Australian PR Journey | ${e.title}`;const r=document.getElementById("page-title");r&&(r.textContent=e.title),B(t),typeof window.__afterRoute=="function"&&window.__afterRoute(t),window.scrollTo({top:0,behavior:"smooth"})}catch(o){console.error(o),n.innerHTML=`<div class="card"><div class="card-header"><i class="fas fa-wifi"></i> Network error</div><p>We couldn't load this page. Please try again.</p></div>`}finally{n.classList.remove("fade-out")}},300))}function lt(t){window.__afterRoute=t,document.addEventListener("click",e=>{const n=e.target.closest("a[href]");if(!n)return;const o=n.getAttribute("href")||"";if(o.startsWith("#"))return;const i=new URL(o,window.location.origin);if(i.hash&&i.pathname===window.location.pathname||!ct(n))return;e.preventDefault(),E();const a=v(n.getAttribute("href"));a!==v(location.pathname)&&(history.pushState({},"",a),b(a))}),window.addEventListener("popstate",()=>{b(v(location.pathname))}),b(v(location.pathname))}function dt(t){const e=document.querySelector(".document-table tbody");e&&(e.innerHTML=t.map(n=>{let o="";return n.status==="Obtained"?o="status-badge--green":n.status==="Booked"?o="status-badge--orange":n.status==="Required"&&(o="status-badge--red"),`
      <tr>
        <td data-label="Document"><i class="fas ${m(n.icon)}"></i> ${m(n.document)}</td>
        <td data-label="Status"><span class="status-badge ${o}">${m(n.status)}</span></td>
        <td data-label="Notes / Expiry">${m(n.notes)}</td>
      </tr>
    `}).join(""))}async function ut(){try{const t=await fetch("/data/documents.json");if(!t.ok)throw new Error("Failed to load documents data");const e=await t.json();dt(e)}catch(t){console.error("Could not initialize documents page:",t)}}const mt={userDOB:"2001-05-18",journeyStartDate:"2025-02-15",initialVisaExpiryDate:"2027-02-15",finalVisaExpiryDate:"2028-02-15",pointsTarget:95,dataVersion:1};function pt(){const t=document.createElement("div");t.className="config-error-banner",t.textContent="⚠️ Could not load live configuration. Displaying default data. Some information may be outdated.",document.body.prepend(t);const e=document.createElement("style");e.textContent=`
    .config-error-banner {
      background-color: #D32F2F;
      color: white;
      text-align: center;
      padding: 0.75rem;
      font-weight: 500;
      font-size: 0.9rem;
    }
  `,document.head.appendChild(e)}function ft(t){const e=document.querySelector(".main-content");e&&(e.innerHTML=`<div class="card"><div class="card-header"><i class="fas fa-exclamation-triangle"></i> Application Error</div><p>${t}</p></div>`,e.classList.remove("fade-out"))}async function gt(){try{const t=await fetch("data/config.json",{credentials:"same-origin"});if(!t.ok)throw new Error(`Failed to load config: ${t.statusText}`);return await t.json()}catch(t){return console.error("Config load failed, falling back to defaults",t),pt(),mt}}async function ht(){try{P();const t=await gt(),{milestones:e,costData:n,pointsData:o}=await O(t);lt(a=>{P(),document.querySelector(".key-metrics")&&Q(e,n,o,t),document.getElementById("timeline")&&tt(e),document.querySelector(".document-table")&&ut()})}catch(t){console.error("Fatal error during application initialization:",t),ft("Could not load the application due to a critical error. Please try refreshing the page.")}}document.addEventListener("DOMContentLoaded",ht);
